---
title: "hugodown configuration"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{hugodown configuration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

There are two types of configuration related to hugodown:

* hugo configuration, because hugodown assumes certain things to be true
  about your hugo setup.
  
* hugodown specific configuration, which allows you to control over various
  ways in which hugodown works.

## Hugo configuration

hugodown does not work with every possible hugo site. There is some config that we assume (typically in `config.toml`, but hugo has a bewildering array of places that this might live instead.)

*   You must use the goldmark markdown renderer, and set `unsafe: true`

    ```toml
    [markup]
      defaultMarkdownHandler = "goldmark"
      [markup.goldmark.renderer]
        unsafe = true
    ```

*   For best syntax hightlighting results, you must use classes:

    ```toml
    pygmentsUseClasses = true
    ```
    
    Then there is some work to be done on the CSS side, refer to
    [the section about syntax highlighting configuration](#syntax-highlighting-configuration).

*   We recommend ignoring knitr intermediates:

    ```toml
    ignoreFiles = ['\.Rmd$', '_files$', '_cache$', '\.knit\.md$', '\.utf8\.md$']
    ```

*   To use html widgets, you must include the following Go template somewhere
    in the `<head>` layout file for your theme. This will help Hugo find the 
    HTML dependencies needed to render the widget in a post. You may find this 
    [blog post](https://zwbetz.com/override-a-hugo-theme/) helpful for 
    overriding Hugo layouts.
  
    ```
    {{ range .Params.html_dependencies }}
      {{ . | safeHTML }}
    {{ end }}
    ```

*   To use mathjax, you will need to use a series of [small hacks][yihui-mathjax]. 
    The easiest way is to copy from an existing template, like [tourmaline].
    Take note of the [`footer_mathjax.html`][footer_mathjax] partial, which
    is then included in the [`footer.html`][footer]. You'll also need to include
    [`math_code.js`][math_code] in your `static/` directory. Once that's done
    you can use inline math like `$math$`, and display math like 
    `` `$$ math $$` `` (note the extra backtick compared to usual).

## hugodown configuration

hugodown also has its own configuration file, `_hugodown.yml`. Currently this has one option:

* `hugo_version`: this defines the version of hugo needed by the current site.

## syntax highlighting configuration

You must ensure that your stylesheet defines styles for the
CSS classes. You can generate starter CSS with (e.g):

```
hugo gen chromastyles --style=pygments > static/css/code-highlight-style.css
```

Substitute `pygments` for the [style of your choice][styles]. Unfortunately,
the correct location for the custom `code-highlight-style.css` file varies by theme, 
so you'll need to do a little 
detective work to figure out the best place to save it; where to refer to it 
(a `customCSS` param in the website configuration? a link in a custom layout? a magical file name?);
and what existing CSS for code and `pre` might need amending.
Below we added some tips for that detective work.

Since downlit that hugodown uses under the hood adds _links_ to code blocks, you 
might also need to tweak CSS for links (if you notice you get wrong vertical alignment 
    of links in code for instance).

### highlight.js inactivation

Many Hugo themes still rely on highlight.js which used to be super handy! 
Now Hugo has server-side/compiling time/native syntax highlighting. 
hugodown uses that, and hugodown's special R highlighting is **not** compatible with highlight.js 
so you have to remove it from the theme. 

From easier to harder, based on the theme you chose:

* read how the theme currently handles syntax highlighting 
(docs might be in the GitHub/GitLab repo README or in the example site... 
that does not necessarily have search). 
If the theme docs indicate how to turn off highlight.js, yay, do that!
* look for "highlight" in existing issues of your theme issue tracker: 
others might have also asked how to turn it off, 
and received ideas or posted their tricks.
* otherwise, look for all occurrences of "highlight" in _the source_ of the theme.
Note that highlight.js works with JS and CSS so you might have to remove scripts, stylesheets, 
and/or links to them from layout files.
Your theme might lack docs about syntax highlighting, but it might still contain docs 
about customization in general. 
If not you'll probably need to create custom head/footer where you use the theme head 
and footer minus references to highlight.js.

### Further tweaks needed

If after that something is still off (colors, alignment) use the [web developer console](https://developer.mozilla.org/en-US/docs/Tools/Web_Console/Opening_the_Web_Console) 
to see what CSS file adds color to code that downlit doesn't put in a span, 
what CSS file adds "inline-block" as alignment to links of a given class. 
Then, override them somehow by adding some lines to your `code-highlight-style.css`...
after checking it is loaded _after_ the guilty stylesheets, otherwise it won't override them.
with CSS, the last stylesheet wins!

[styles]: https://xyproto.github.io/splash/docs/longer/all.html
